Ext.define("Ext.ux.touch.grid.feature.Paging",{extend:"Ext.ux.touch.grid.feature.Abstract",requires:["Ext.ux.touch.grid.feature.Abstract","Ext.dataview.List"],config:{events:{store:{load:"handleGridPaint"}},backButton:{text:"Previous Page",ui:"back"},forwardButton:{text:"Next Page",ui:"forward"},goToButton:{text:"Go to page..."},pager:{xtype:"toolbar",docked:"top",layout:{type:"hbox"}},pageListTpl:"Page {page}",goToPicker:null,pages:0},backText:"back",init:function(d){var e=this,c=e.getBackButton(),f=e.getForwardButton(),b=e.getGoToButton(),a=e.getPager();Ext.apply(c,{action:"back",disabled:true,scope:this,handler:"handleBackButton"});Ext.apply(f,{action:"forward",disabled:true,scope:this,handler:"handleForwardButton"});Ext.apply(b,{action:"goTo",disabled:true,scope:this,handler:"handleGoToButton"});Ext.apply(a,{items:[c,{xtype:"spacer"},b,{xtype:"spacer"},f]});e.setPager(a=d.insert(0,a));e.setBackButton(a.down("button[action=back]"));e.setForwardButton(a.down("button[action=forward]"));e.setGoToButton(a.down("button[action=goTo]"));d.on("painted","handleGridPaint",this,{buffer:50})},handleGridPaint:function(a){if(!(a instanceof Ext.ux.touch.grid.View)){a=this.getGrid()}var e=this,h=a.getStore();if(h.isLoading()){h.on("load","handleGridPaint",this,{single:true});return}var f=h.getTotalCount(),d=h.currentPage,c=Math.ceil(f/h.getPageSize()),i=e.getBackButton(),g=e.getForwardButton(),b=e.getGoToButton();e.setPages(c);i.setDisabled(d==1);g.setDisabled(d==c);b.setDisabled(c==0)},handleBackButton:function(){var b=this.getGrid(),a=b.getStore();a.previousPage()},handleForwardButton:function(){var b=this.getGrid(),a=b.getStore();a.nextPage()},handleGoToButton:function(e){var f=this,c=f.getGoToPicker(),a=f.getPages(),d=1,g=[];if(!c){c=f.buildPicker()}var b=c.down("list").getStore();b.removeAll();for(;d<=a;d++){g.push({page:d})}b.add(g);c.showBy(e)},buildPicker:function(){return Ext.create("Ext.Panel",{centered:true,modal:true,width:200,height:200,layout:"fit",items:[{xtype:"list",itemTpl:this.getPageListTpl(),store:Ext.create("Ext.data.Store",{fields:["page"]}),listeners:{scope:this,itemtap:"handlePageSelect"}}]})},handlePageSelect:function(e,c){var a=e.up("panel"),b=this.getGrid().getStore(),d=c+1;b.loadPage(d);a.hide()}});